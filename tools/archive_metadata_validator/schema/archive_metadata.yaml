$schema: "http://json-schema.org/draft-07/schema#"
$id: "http://psychoinformatics.inm7.de/schemas/archived_study.json"

definitions:
  person-record:
    type: object
    additionalProperties: false
    required:
      - given_name
      - last_name
    properties:
      given_name:
        type: string
      last_name:
        type: string
      orcid-id:
        type: string
      title:
        type: string
      affiliation:
        type: string
      contact_information:
        type: string

  person-set:
    type: object
    additionalProperties: false
    patternProperties:
      ^[^@]+@[^@]+$:
        $ref: "#definitions/person-record"

  person-ref:
    type: string
    format: email

  person-ref-list:
    type: array
    minItems: 1
    uniqueItems: true
    items:
      $ref: "#definitions/person-ref"

  author-ref:
    oneOf:
      - $ref: "#definitions/person-ref"
      - $ref: "#definitions/person-ref-list"

  number-or-id-ref:
    oneOf:
      - type: integer
      - type: string

  date:
    type: string
    format: date

  license:
    type: object
    additionalProperties: false
    required:
      - name
      - url
    properties:
      name:
        type: string
      url:
        type: string

  publication:
    type: object
    additionalProperties: false
    required:
      - title
      - author
      - year
    properties:
      title:
        type: string
      author:
        $ref: "#definitions/author-ref"
      year:
        type: integer
      corresponding_author:
        $ref: "#definitions/person-ref"
      doi:
        type: string
      publication:
        type: string
      volume:
        $ref: "#definitions/number-or-id-ref"
      issue:
        $ref: "#definitions/number-or-id-ref"
      pages:
        $ref: "#definitions/number-or-id-ref"
      publisher:
        type: string

  keyword-entry:
    type: string

  keyword-list:
    type: array
    minItems: 1
    uniqueItems: true
    items:
      $ref: "#definitions/keyword-entry"

  keyword-spec:
    oneOf:
      - $ref: "#definitions/keyword-entry"
      - $ref: "#definitions/keyword-list"

  funding-entry:
    type: string

  funding-list:
    type: array
    minItems: 1
    uniqueItems: true
    items:
      $ref: "#definitions/funding-entry"

  funding-spec:
    oneOf:
      - $ref: "#definitions/funding-entry"
      - $ref: "#definitions/funding-list"

  publication-list:
    type: array
    minItems: 1
    uniqueItems: true
    items:
      $ref: "#definitions/publication"

  standard-list:
    type: array
    items:
      type: string

  dataset:
    description: The data that should be archived
    type: object
    additionalProperties: false
    required:
      - name
      - location
      - author
    properties:
      name:
        type: string
      location:
        description: URL of the entry point for the data
        type: string
      author:
        $ref: "#definitions/author-ref"
      keyword:
        $ref: "#definitions/keyword-spec"
      description:
        description: Human-readable description of the data and what it describes
        type: string
      funding:
        $ref: "#definitions/funding-spec"
      standard:
        $ref: "#definitions/standard-list"
      license:
        $ref: "#definitions/license"

  study:
    type: object
    additionalProperties: false
    required:
      - name
      - principal_investigator
      - keyword
    properties:
      name:
        type: string
      principal_investigator:
        $ref: "#definitions/person-ref"
      keyword:
        $ref: "#definitions/keyword-spec"
      funding:
        $ref: "#definitions/funding-spec"
      purpose:
        description: Why was the study performed
        type: string
      start_date:
        $ref: "#definitions/date"
      end_date:
        $ref: "#definitions/date"
      contributor:
        $ref: "#definitions/person-ref-list"

type: object
additionalProperties: false
required:
  - study
  - dataset
  - person
properties:
  study:
    $ref: "#definitions/study"
  dataset:
    $ref: "#definitions/dataset"
  publication:
    $ref: "#definitions/publication-list"
  person:
    $ref: "#definitions/person-set"
  additional_information:
    type: string
